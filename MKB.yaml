%YAML 1.2
---
# See http://www.sublimetext.com/docs/3/syntax.html
name: MKB
first_line_match: '\$\$\{'
file_extensions:
  - txt
  - rtf
scope: mcdefault

variables:
  actions: 'HACK|GETSLOTITEMENCHANTS|GETSLOTITEMEXT|GETSLOTITEMNBT|GETSIGNTEXT|SETSIGNTEXT|GETCLIPBOARD|SETCLIPBOARD|ADDDOCS|LISTDOCS|JSONADD|ISINTEGER|JSONREMOVE|GETJSONASARRAY|JSONARRAYADD|ISJSONOBJECT|ISSTRING|JSONARRAYGET|JSONGET|ISFLOAT|ISJSONPRIMITIVE|ISBOOLEAN|ISJSONARRAY|ISNUMBER|GETJSONKEYS|JSONARRAYSIZE|JSONHAS|NOTIFY|SHUFFLE|TRIM|FUNCTIONNOTEXISTING|CHAR|EVAL|MOD|OLDNAME|PLAYERLIST|READFILE|UNIX|FILEEXISTS|MKDIR|WRITEFILE|HTTPPUT|HTTPPOST|URLENCODE|HTTPDELETE|HTTPGET|SETREQUESTHEADER|NULL|CLEARCRAFTING|CRAFT|CRAFTANDWAIT|DISCONNECT|GETID|GETIDREL|GETITEMINFO|GETSLOT|GETSLOTITEM|INVENTORYDOWN|INVENTORYUP|ITEMID|ITEMNAME|LOOK|LOOKS|PICK|PLACESIGN|PLAYSOUND|RESPAWN|SETSLOTITEM|SLOT|SLOTCLICK|SPRINT|TILEID|TILENAME|TRACE|UNSPRINT|SELECTCHANNEL|SENDMESSAGE|KEY|KEYDOWN|KEYUP|PRESS|TOGGLEKEY|TYPE|ARRAYSIZE|ASSIGN|BREAK|CALCYAWTO|DEC|DECODE|DO|ECHO|ELSE|ELSEIF|ENCODE|ENDIF|ENDUNSAFE|EXEC|FOR|FOREACH|GETPROPERTY|IF|IFBEGINSWITH|IFCONTAINS|IFENDSWITH|IFMATCHES|IIF|INC|INDEXOF|ISRUNNING|JOIN|LCASE|LOG|LOGRAW|LOGTO|LOOP|MATCH|NEXT|POP|PROMPT|PUSH|PUT|RANDOM|REGEXREPLACE|REPLACE|SET|SETLABEL|SETPROPERTY|SPLIT|SQRT|STOP|STRIP|TOGGLE|UCASE|UNSAFE|UNSET|UNTIL|WAIT|WHILE|CONFIG|IMPORT|UNIMPORT|BIND|CAMERA|CHATHEIGHT|CHATHEIGHTFOCUSED|CHATOPACITY|CHATSCALE|CHATVISIBLE|CHATWIDTH|FOG|FOV|GAMMA|MUSIC|RELOADRESOURCES|RESOURCEPACKS|SENSITIVITY|SETRES|SHADERGROUP|VOLUME|ACHIEVEMENTGET|BINDGUI|CLEARCHAT|GUI|POPUPMESSAGE|REPL|SHOWGUI|STORE|STOREOVER|TIME|TITLE|TOAST|CHATFILTER|FILTER|MODIFY|PASS|HTTP|IFFILEEXISTS|SORT|TEAMMEMBERS|SCORE|COUNTDOWNTO|COUNTDOWNFROM|COUNTER|COUNTUP|LEFTPAD|TIMETOSEC|SECTOTIME|GETSLOTITEMINV|GETSLOTINV|IFINVISFULL|IFENCHANTED|GETMOUSEITEM|GETEMPTYSLOTS|GETCHESTNAME|GETFISHHOOK|hack|getslotitemenchants|getslotitemext|getslotitemnbt|getsigntext|setsigntext|getclipboard|setclipboard|adddocs|listdocs|jsonadd|isinteger|jsonremove|getjsonasarray|jsonarrayadd|isjsonobject|isstring|jsonarrayget|jsonget|isfloat|isjsonprimitive|isboolean|isjsonarray|isnumber|getjsonkeys|jsonarraysize|jsonhas|notify|shuffle|trim|functionnotexisting|char|eval|mod|oldname|playerlist|readfile|unix|fileexists|mkdir|writefile|httpput|httppost|urlencode|httpdelete|httpget|setrequestheader|null|clearcrafting|craft|craftandwait|disconnect|getid|getidrel|getiteminfo|getslot|getslotitem|inventorydown|inventoryup|itemid|itemname|look|looks|pick|placesign|playsound|respawn|setslotitem|slot|slotclick|sprint|tileid|tilename|trace|unsprint|selectchannel|sendmessage|key|keydown|keyup|press|togglekey|type|arraysize|assign|break|calcyawto|dec|decode|do|echo|else|elseif|encode|endif|endunsafe|exec|for|foreach|getproperty|if|ifbeginswith|ifcontains|ifendswith|ifmatches|iif|inc|indexof|isrunning|join|lcase|log|lograw|logto|loop|match|next|pop|prompt|push|put|random|regexreplace|replace|set|setlabel|setproperty|split|sqrt|stop|strip|toggle|ucase|unsafe|unset|until|wait|while|config|import|unimport|bind|camera|chatheight|chatheightfocused|chatopacity|chatscale|chatvisible|chatwidth|fog|fov|gamma|music|reloadresources|resourcepacks|sensitivity|setres|shadergroup|volume|achievementget|bindgui|clearchat|gui|popupmessage|repl|showgui|store|storeover|time|title|toast|chatfilter|filter|modify|pass|http|iffileexists|sort|teammembers|score|countdownto|countdownfrom|counter|countup|leftpad|timetosec|sectotime|getslotiteminv|getslotinv|ifinvisfull|ifenchanted|getmouseitem|getemptyslots|getchestname|getfishhook|'
  variables: 'ALT|AMBIENTVOLUME|ARMOUR|ATTACKPOWER|ATTACKSPEED|BIOME|BLOCKVOLUME|BOOTSDAMAGE|BOOTSDURABILITY|BOOTSID|BOOTSNAME|BOWCHARGE|CAMERA|CANFLY|CARDINALYAW|CHESTPLATEDAMAGE|CHESTPLATEDURABILITY|CHESTPLATEID|CHESTPLATENAME|CHUNKUPDATES|CONFIG|CONTAINERSLOTS|COOLDOWN|CTRL|DATE|DATETIME|DAY||DAYTICKS|DAYTIME|DIFFICULTY|DIMENSION|DIRECTION|DISPLAYHEIGHT|DISPLAYNAME|DISPLAYWIDTH|DURABILITY|FILESEPARATOR|FLYING|FOV|FPS|GAMEMODE|GAMMA|GUI|HACKED|HEALTH|HELMDAMAGE|HELMDURABILITY|HELMID|HELMNAME|HIT|HITDATA|HITID|HITNAME|HITPROGRESS|HITSIDE|HITUUID|HITX|HITY|HITZ|HIT_AGE|HIT_ATTACHED|HIT_AXIS|HIT_BITES|HIT_CHECK_DECAY|HIT_COLOR|HIT_CONDITIONAL|HIT_CONTENTS|HIT_DAMAGE|HIT_DECAYABLE|HIT_DELAY|HIT_DISARMED|HIT_DOWN|HIT_EAST|HIT_ENABLED|HIT_EXPLODE|HIT_EXTENDED|HIT_EYE|HIT_FACING|HIT_HALF|HIT_HAS_BOTTLE_0|HIT_HAS_BOTTLE_1|HIT_HAS_BOTTLE_2|HIT_HAS_RECORD|HIT_HINGE|HIT_IN_WALL|HIT_LAYERS|HIT_LEGACY_DATA|HIT_LEVEL|HIT_LOCKED|HIT_MODE|HIT_MOISTURE|HIT_NODROP|HIT_NORTH|HIT_OCCUPIED|HIT_OPEN|HIT_PART|HIT_POWER|HIT_POWERED|HIT_ROTATION|HIT_SEAMLESS|HIT_SHAPE|HIT_SHORT|HIT_SNOWY|HIT_SOUTH|HIT_STAGE|HIT_TRIGGERED|HIT_TYPE|HIT_UP|HIT_VARIANT|HIT_WEST|HIT_WET|HOSTILEVOLUME|HUNGER|INVSLOT|ITEM|ITEMCODE|ITEMDAMAGE|ITEMIDDMG|ITEMNAME|ITEMUSEPCT|ITEMUSETICKS|KEYID|KEYNAME|KEY_0|KEY_1|KEY_2|KEY_3|KEY_4|KEY_5|KEY_6|KEY_7|KEY_8|KEY_9|KEY_A|KEY_ADD|KEY_APOSTROPHE|KEY_APPS|KEY_AT|KEY_AX|KEY_B|KEY_BACK|KEY_BACKSLASH|KEY_C|KEY_CAPITAL|KEY_CIRCUMFLEX|KEY_CLEAR|KEY_COLON|KEY_COMMA|KEY_CONVERT|KEY_D|KEY_DECIMAL|KEY_DELETE|KEY_DIVIDE|KEY_DOWN|KEY_E|KEY_END|KEY_EQUALS|KEY_ESCAPE|KEY_F|KEY_F1|KEY_F10|KEY_F11|KEY_F12|KEY_F13|KEY_F14|KEY_F15|KEY_F16|KEY_F17|KEY_F18|KEY_F19|KEY_F2|KEY_F3|KEY_F4|KEY_F5|KEY_F6|KEY_F7|KEY_F8|KEY_F9|KEY_FUNCTION|KEY_G|KEY_GRAVE|KEY_H|KEY_HOME|KEY_I|KEY_INSERT|KEY_J|KEY_K|KEY_KANA|KEY_KANJI|KEY_L|KEY_LBRACKET|KEY_LCONTROL|KEY_LEFT|KEY_LMENU|KEY_LMETA|KEY_LSHIFT|KEY_M|KEY_MINUS|KEY_MOUSE3|KEY_MOUSE4|KEY_MULTIPLY|KEY_N|KEY_NEXT|KEY_NOCONVERT|KEY_NONE|KEY_NUMLOCK|KEY_NUMPAD0|KEY_NUMPAD1|KEY_NUMPAD2|KEY_NUMPAD3|KEY_NUMPAD4|KEY_NUMPAD5|KEY_NUMPAD6|KEY_NUMPAD7|KEY_NUMPAD8|KEY_NUMPAD9|KEY_NUMPADCOMMA|KEY_NUMPADENTER|KEY_NUMPADEQUALS|KEY_O|KEY_P|KEY_PAUSE|KEY_PERIOD|KEY_POWER|KEY_PRIOR|KEY_Q|KEY_R|KEY_RBRACKET|KEY_RCONTROL|KEY_RETURN|KEY_RIGHT|KEY_RMENU|KEY_RMETA|KEY_RSHIFT|KEY_S|KEY_SCROLL|KEY_SECTION|KEY_SEMICOLON|KEY_SLASH|KEY_SLEEP|KEY_SPACE|KEY_STOP|KEY_SUBTRACT|KEY_SYSRQ|KEY_T|KEY_TAB|KEY_U|KEY_UNDERLINE|KEY_UNLABELED|KEY_UP|KEY_V|KEY_W|KEY_X|KEY_Y|KEY_YEN|KEY_Z|LATENCY|LEGGINGSDAMAGE|LEGGINGSDURABILITY|LEGGINGSID|LEGGINGSNAME|LEVEL|LIGHT|LMOUSE|LOCALDIFFICULTY|MACROSCONFIGDIR|MAINHANDCOOLDOWN|MAINHANDDURABILITY|MAINHANDITEM|MAINHANDITEMCODE|MAINHANDITEMDAMAGE|MAINHANDITEMIDDMG|MAINHANDITEMNAME|MAINHANDSTACKSIZE|MAXPLAYERS|MIDDLEMOUSE|MINECRAFTDIR|MODE|MODULECLIPBOARD|MODULEGETSLOTITEMEXT|MODULEHTTP|MODULEJSON|MODULENEI|MODULESIGNTEXT|MUSIC|NEUTRALVOLUME|NOTIFICATIONMODULE|OFFHANDCOOLDOWN|OFFHANDDURABILITY|OFFHANDITEM|OFFHANDITEMCODE|OFFHANDITEMDAMAGE|OFFHANDITEMIDDMG|OFFHANDITEMNAME|OFFHANDSTACKSIZE|ONLINEPLAYERS|OXYGEN|PITCH|PLAYER|PLAYERVOLUME|RAIN|RECORDVOLUME|RESOURCEPACKS|RMOUSE|SATURATION|SCREEN|SCREENNAME|SEED|SENSITIVITY|SERVER|SERVERMOTD|SERVERNAME|SHADERGROUP|SHIFT|SOUND|STACKSIZE|TICKS|TIME|TIMESTAMP|TOTALTICKS|TOTALXP|UNIQUEID|UUID|VEHICLE|VEHICLEHEALTH|WEATHERVOLUME|XP|XPOS|XPOSF|YAW|YPOS|YPOSF|ZPOS|ZPOSF|~ALT|~CTRL|~KEY_0|~KEY_1|~KEY_2|~KEY_3|~KEY_4|~KEY_5|~KEY_6|~KEY_7|~KEY_8|~KEY_9|~KEY_A|~KEY_ADD|~KEY_APOSTROPHE|~KEY_APPS|~KEY_AT|~KEY_AX|~KEY_B|~KEY_BACK|~KEY_BACKSLASH|~KEY_C|~KEY_CAPITAL|~KEY_CIRCUMFLEX|~KEY_CLEAR|~KEY_COLON|~KEY_COMMA|~KEY_CONVERT|~KEY_D|~KEY_DECIMAL|~KEY_DELETE|~KEY_DIVIDE|~KEY_DOWN|~KEY_E|~KEY_END|~KEY_EQUALS|~KEY_ESCAPE|~KEY_F|~KEY_F1|~KEY_F10|~KEY_F11|~KEY_F12|~KEY_F13|~KEY_F14|~KEY_F15|~KEY_F16|~KEY_F17|~KEY_F18|~KEY_F19|~KEY_F2|~KEY_F3|~KEY_F4|~KEY_F5|~KEY_F6|~KEY_F7|~KEY_F8|~KEY_F9|~KEY_FUNCTION|~KEY_G|~KEY_GRAVE|~KEY_H|~KEY_HOME|~KEY_I|~KEY_INSERT|~KEY_J|~KEY_K|~KEY_KANA|~KEY_KANJI|~KEY_L|~KEY_LBRACKET|~KEY_LCONTROL|~KEY_LEFT|~KEY_LMENU|~KEY_LMETA|~KEY_LSHIFT|~KEY_M|~KEY_MINUS|~KEY_MOUSE3|~KEY_MOUSE4|~KEY_MULTIPLY|~KEY_N|~KEY_NEXT|~KEY_NOCONVERT|~KEY_NONE|~KEY_NUMLOCK|~KEY_NUMPAD0|~KEY_NUMPAD1|~KEY_NUMPAD2|~KEY_NUMPAD3|~KEY_NUMPAD4|~KEY_NUMPAD5|~KEY_NUMPAD6|~KEY_NUMPAD7|~KEY_NUMPAD8|~KEY_NUMPAD9|~KEY_NUMPADCOMMA|~KEY_NUMPADENTER|~KEY_NUMPADEQUALS|~KEY_O|~KEY_P|~KEY_PAUSE|~KEY_PERIOD|~KEY_POWER|~KEY_PRIOR|~KEY_Q|~KEY_R|~KEY_RBRACKET|~KEY_RCONTROL|~KEY_RETURN|~KEY_RIGHT|~KEY_RMENU|~KEY_RMETA|~KEY_RSHIFT|~KEY_S|~KEY_SCROLL|~KEY_SECTION|~KEY_SEMICOLON|~KEY_SLASH|~KEY_SLEEP|~KEY_SPACE|~KEY_STOP|~KEY_SUBTRACT|~KEY_SYSRQ|~KEY_T|~KEY_TAB|~KEY_U|~KEY_UNDERLINE|~KEY_UNLABELED|~KEY_UP|~KEY_V|~KEY_W|~KEY_X|~KEY_Y|~KEY_YEN|~KEY_Z|~LMOUSE|~MIDDLEMOUSE|~RMOUSE|~SHIFT|FARHIT|FARHITID|FARHITDATA|FARHITNAME|FARHITSIDE|FARHITX|FARHITY|FARHITZ|FARHITUUID|FARHITDIST|MDULEFARHIT'
  parameters: '\$\$!|\$\$\?|\$\$\[.{1,}\]|\$\$<.+\.txt>|\$\$\d|\$\$f|\$\$h|\$\$i:d|\$\$k|\$\$m|\$\$p|\$\$s|\$\$t|\$\$u|\$\$w'

contexts:
  # The prototype context is prepended to all contexts but those setting
  # meta_include_prototype: false.

  prototype:
    - include: comments

  main:
    # The main context is the initial starting point of our syntax.
    # Include other contexts from here (or specify them directly).
    - match: '(^[\w\d\s]+[^;]$)'
      scope: mcdefault
    - match: '((?<=;)(.*))'
      captures:
        2: mcdefault
    - match: '(?<!\\)"'
      push: strings
    - include: keywords
    - include: numbers
    - include: actions
    - include: variables
    - include: iterators
    - include: parameters
    - include: operators
    - include: booleans
    - include: repl
    - include: prefixes

  strings:
    - meta_scope: mcstrings
    - match: '(\]%)'
      scope: mckeywords
    - match: '(?<!\\)"'
      pop: true
    - match: '({{parameters}})|((%)(({{variables}})|([^%\[\]"]*?))(%))'
      captures:
        1: mcparameters
        3: mckeywords
        5: mcvariables
        6: mcprefixes
        7: mckeywords
    - match: '({{parameters}})|((%)([^%\[\]"]*?)(\[))'
      captures:
        1: mcparameters
        3: mckeywords
        4: mcprefixes
        5: mckeywords
      push: main2

  main2:
    - meta_scope: mcstrings
    - match: '[^\"\[\]%]*?(((\-)?[\d.]+)|(true|false|TRUE|FALSE)|(<|>|==|!=|!|>=|<=|\+|\-(?!\d)|\*|\/|=|\(|\))|({{parameters}})|((%)(({{variables}})|([^%\[\]"]*?))(\[|%)))'
      captures:
        2: mcnumbers
        4: mcbooleans
        5: mcoperators
        6: mcparameters
        8: mckeywords
        10: mcvariables
        11: mcprefixes
        12: mckeywords
    - match: '(\]%)'
      scope: mckeywords
    - match: '\b"|'
      pop: true

  keywords:
    - match: '\$\$\{|\}\$\$|;|,|%|\(|\)|\[|\]|'
      scope: mckeywords

  parameters:
    - match: '{{parameters}}'
      scope: mcparameters

  numbers:
    - match: '(\-)?[\d.]+'
      scope: mcnumbers

  prefixes:
    - match: '((@)??[#&\b]??[a-zA-Z0-9]*(?=\b))'
      scope: mcprefixes

  comments:
    - match: '(//.*;)'
      scope: mccomments

  actions:
    - match: '\b({{actions}})\b'
      scope: mcactions

  variables:
    - match: '\b({{variables}})\b'
      scope: mcvariables

  iterators:
    - match: 'iterators|controls|teams|scores|players|trades|enchantments|env|running|effects|entities|objectives|actions|events|properties'
      scope: mciterators

  operators:
    - match: '<|>|==|!=|!|>=|<=|&&|\|\||to|as|step|=>|\+|\-(?!\d)|\*|\/|='
      scope: mcoperators

  booleans:
    - match: (true|false|TRUE|FALSE)
      scope: mcbooleans

  repl:
    - match: 'BEGIN|CAT <.+\.txt>|CLS|EDIT .+\.txt|END|EXIT|HELP .*|KILL .*|LIST|LIVE .*|RM <.+\.txt>|RUN <.+\.txt> .*|SAY .*|SHUTDOWN|TASKS|VERSION|WHOAMI'
      scope: mcrepl
